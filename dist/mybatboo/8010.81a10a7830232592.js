"use strict";(self.webpackChunkmybatboo=self.webpackChunkmybatboo||[]).push([[8010],{8010:(B,u,t)=>{t.r(u),t.d(u,{DiagnosisRequestModalComponent:()=>I});var a=t(5649),T=t(974),f=t(9401),D=t(2704),b=t(9300),M=t(5698),P=t(1135),c=t(8505),x=t(262),O=t(515),Z=t(4650),E=t(4657);const v=(0,t(7423).fo)("Geolocation",{web:()=>t.e(4561).then(t.bind(t,4561)).then(i=>new i.GeolocationWeb)});var U=t(4545),e=t(2223),L=t(6814),C=t(8740),N=t(8615),J=t(5800),A=t(9529),k=t(4135),S=t(7204),p=t(3437),$=t(4755);let I=(()=>{class i extends a.NT{constructor(s,o,n,l,g,d,m,r,h){super(),this.store$=s,this.modalRef=o,this.api=n,this.diagnosisService=l,this.cameraService=g,this.router=d,this.modalService=m,this.toast=r,this.alert=h,this.cropType=new f.NI(null),this.status$=new P.X(a.Lr.INITIAL)}ngOnInit(){this.modalRef.setClass("diagnosis-request-modal"),this.subscribeOn(this.store$.select(D.mC).pipe((0,b.h)(s=>!!s),(0,c.b)(s=>this.cropType.patchValue(s)))),this.geoLocationPromise=v.getCurrentPosition().then(s=>(this.geolocation=s,s))}selectCropType(s){this.cropType.patchValue(s)}close(){this.modalRef.hide()}retakePhoto(){this.close(),this.requestSubscription$&&this.requestSubscription$?.unsubscribe(),this.diagnosisService.startDiagnosis()}request(){const s=({latitude:o,longitude:n})=>{const l="mybatboo_"+(new Date).getTime()+".jpg";this.status$.next(a.Lr.PENDING),this.cameraService.writeFileToDevice(this.cropPhoto.dataUrl,l).then(g=>{this.cameraService.readFileFromDevice(g.fileName).then(d=>{this.requestSubscription$=this.api.requestDiagnosis({cropType:this.cropType.value,image:d,geolocation:{latitude:o,longitude:n}}).pipe((0,M.q)(1),(0,c.b)(()=>this.status$.next(a.Lr.FULFILLED)),(0,c.b)(()=>this.store$.dispatch(U.q.setRecentCropType({recentCropType:this.cropType.value}))),(0,c.b)(r=>{this.close(),Promise.all([t.e(5554),t.e(8054),t.e(7615),t.e(8592)]).then(t.bind(t,7615)).then(h=>{this.modalService.show(h.DiagnosisResultComponent,{initialState:{diagnosisRecord:r.data}})}),this.cameraService.deleteImageFromDevice(l).then(()=>console.log("image deleted"))}),(0,x.K)(r=>("NOTHING_DETECTED"===r.error?.code||"NOTHING_DETECTED"===r.code?this.alert.alert({title:"\uac80\ucd9c \ub300\uc0c1\uc744 \ucc3e\uc9c0 \ubabb\ud588\uc2b5\ub2c8\ub2e4.",content:"\uc791\ubb3c\uc774 \uc0ac\uc9c4 \uc548\uc5d0 \uc798 \ub4e4\uc5b4\uc624\ub3c4\ub85d \ub2e4\uc2dc \ucd2c\uc601\ud574\uc8fc\uc138\uc694.",closeMessage:"\ud655\uc778",closeButtonColor:"green"}).pipe((0,c.b)(()=>this.close())).subscribe():(this.toast.show(r.message),this.status$.next(a.Lr.REJECTED)),O.E))).subscribe()}).catch(d=>{this.toast.show("\uc774\ubbf8\uc9c0 \ub85c\ub4dc\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4. \ub2e4\uc2dc \uc2dc\ub3c4\ud574\uc8fc\uc138\uc694."),this.status$.next(a.Lr.REJECTED)})}).catch(g=>{this.toast.show("\ucd2c\uc601\ud55c \uc774\ubbf8\uc9c0\ub97c \uac00\uc838\uc624\ub294\ub370 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4. \ub2e4\uc2dc \uc2dc\ub3c4\ud574\uc8fc\uc138\uc694."),this.status$.next(a.Lr.REJECTED)})};if(this.geolocation){const{latitude:o,longitude:n}=this.geolocation.coords;s({latitude:o,longitude:n})}else v.getCurrentPosition().then(o=>{const{latitude:n,longitude:l}=o.coords;s({latitude:n,longitude:l})})}}return i.\u0275fac=function(s){return new(s||i)(e.Y36(L.yh),e.Y36(C.UZ),e.Y36(N.s),e.Y36(J.r),e.Y36(A.y),e.Y36(k.F0),e.Y36(C.tT),e.Y36(S.k),e.Y36(p.c9))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-diagnosis-request-modal"]],inputs:{cropPhoto:"cropPhoto"},standalone:!0,features:[e.qOj,e.jDz],decls:22,vars:26,consts:[["height","64px",3,"title"],["left","",1,"back-button",3,"click"],["name","chevron_left","color","green","size","28px"],[1,"image-preview"],["alt","crop-image",3,"src"],[1,"crop-type-selector"],["label","\uace0\ucd94",3,"variant","color","click"],["left","","src","/assets/images/pepper.png","alt","",1,"crop-icon-img"],["label","\ub538\uae30",3,"variant","color","click"],["left","","src","/assets/images/strawberry.png","alt","",1,"crop-icon-img"],["label","\uc0c1\ucd94",3,"variant","color","click"],["left","","src","/assets/images/lettuce.png","alt","",1,"crop-icon-img"],["label","\ud1a0\ub9c8\ud1a0",3,"variant","color","click"],["left","","src","/assets/images/tomato.png","alt","",1,"crop-icon-img"],["height","81px"],["label","\ub2e4\uc2dc \ucd2c\uc601\ud558\uae30","variant","weak","color","red","size","m",3,"click"],["left","","name","undo"],["label","\uc9c4\ub2e8 \uc2dc\uc791","variant","weak","color","greenDark","size","m",3,"disabled","loading","click"],["left","","name","send"]],template:function(s,o){1&s&&(e.TgZ(0,"page-header",0)(1,"div",1),e.NdJ("click",function(){return o.close()}),e._UZ(2,"mp-icon",2),e.TgZ(3,"span"),e._uU(4,"Back"),e.qZA()()(),e.TgZ(5,"div",3),e._UZ(6,"img",4),e.qZA(),e.TgZ(7,"div",5)(8,"mp-button",6),e.NdJ("click",function(){return o.selectCropType(0)}),e._UZ(9,"img",7),e.qZA(),e.TgZ(10,"mp-button",8),e.NdJ("click",function(){return o.selectCropType(1)}),e._UZ(11,"img",9),e.qZA(),e.TgZ(12,"mp-button",10),e.NdJ("click",function(){return o.selectCropType(2)}),e._UZ(13,"img",11),e.qZA(),e.TgZ(14,"mp-button",12),e.NdJ("click",function(){return o.selectCropType(3)}),e._UZ(15,"img",13),e.qZA()(),e.TgZ(16,"bottom-fixed-bar",14)(17,"mp-button",15),e.NdJ("click",function(){return o.retakePhoto()}),e._UZ(18,"mp-icon",16),e.qZA(),e.TgZ(19,"mp-button",17),e.NdJ("click",function(){return o.request()}),e.ALo(20,"async"),e._UZ(21,"mp-icon",18),e.qZA()()),2&s&&(e.Q6J("title","\uc9c4\ub2e8 \uc694\uccad"),e.xp6(6),e.Q6J("src",o.cropPhoto.dataUrl,e.LSH),e.xp6(2),e.Udp("border",0===o.cropType.value?"1px solid var(--green)":"1px solid var(--grayLight)"),e.Q6J("variant",0===o.cropType.value?"weak":"void")("color",0===o.cropType.value?"greenDark":"grayDark"),e.xp6(2),e.Udp("border",1===o.cropType.value?"1px solid var(--green)":"1px solid var(--grayLight)"),e.Q6J("variant",1===o.cropType.value?"weak":"void")("color",1===o.cropType.value?"greenDark":"grayDark"),e.xp6(2),e.Udp("border",2===o.cropType.value?"1px solid var(--green)":"1px solid var(--grayLight)"),e.Q6J("variant",2===o.cropType.value?"weak":"void")("color",2===o.cropType.value?"greenDark":"grayDark"),e.xp6(2),e.Udp("border",3===o.cropType.value?"1px solid var(--green)":"1px solid var(--grayLight)"),e.Q6J("variant",3===o.cropType.value?"weak":"void")("color",3===o.cropType.value?"greenDark":"grayDark"),e.xp6(3),e.Udp("border","1px solid var(--redLight)"),e.xp6(2),e.Udp("border","1px solid var(--green)"),e.Q6J("disabled",!o.cropType.value&&0!==o.cropType.value)("loading",e.lcZ(20,24,o.status$).pending))},dependencies:[T.B,p.zJ,p.gL,p.k_,$.Ov,Z.q,E.N],styles:['@charset "UTF-8";  .modal-dialog.diagnosis-request-modal{max-width:100vw;max-height:var(--full-height);margin:0}  .modal-dialog.diagnosis-request-modal .modal-content{display:block;border-radius:0;width:100vw;height:var(--full-height);margin:0}[_nghost-%COMP%]   page-header[_ngcontent-%COMP%]{box-shadow:inset 0 -1px #0000001f}[_nghost-%COMP%]   page-header[_ngcontent-%COMP%]   .back-button[_ngcontent-%COMP%]{display:flex;align-items:center;font-size:18px;color:var(--green);font-weight:500}[_nghost-%COMP%]   .image-preview[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;box-shadow:inset 0 -1px #0000001f}[_nghost-%COMP%]   .image-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;aspect-ratio:1/1}[_nghost-%COMP%]   .crop-type-selector[_ngcontent-%COMP%]{padding:24px;display:grid;grid-template-columns:repeat(2,1fr);grid-column-gap:16px;grid-row-gap:16px}[_nghost-%COMP%]   .crop-type-selector[_ngcontent-%COMP%]   .crop-icon-img[_ngcontent-%COMP%]{width:36px;height:36px}[_nghost-%COMP%]   .crop-type-selector[_ngcontent-%COMP%]   mp-button.selected[_ngcontent-%COMP%]{border:1px solid var(--green)}[_nghost-%COMP%]   bottom-fixed-bar[_ngcontent-%COMP%]{padding:12px 24px;display:flex;justify-content:space-between;align-items:center;gap:16px}[_nghost-%COMP%]   bottom-fixed-bar[_ngcontent-%COMP%]   mp-button[_ngcontent-%COMP%]{flex:1}']}),i})()}}]);